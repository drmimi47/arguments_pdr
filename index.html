<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Experience</title>
  
  <!-- AR.js library for camera-based AR -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
  
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: black; /* Black background */
    }
    .ui-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 100;
      background: black; /* Ensure black overlay */
    }
    .instructions {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 25px;
      text-align: center;
      font-size: 16px;
      max-width: 80%;
      pointer-events: auto;
    }
    .pulse-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      border: 3px solid rgba(255,255,255,0.8);
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      animation: pulse 2s ease-in-out infinite;
      pointer-events: auto; /* Make clickable */
      cursor: pointer;
    }
    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.6; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    .controls {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      pointer-events: auto;
    }
    .btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(0,0,0,0.8);
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .error {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,0,0,0.9);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      z-index: 200;
      max-width: 80%;
      display: none;
    }
    .a-enter-vr { display: none !important; }
    
    /* Hide the A-Frame scene completely */
    a-scene {
      display: none !important;
    }
    
    /* Content overlay for AR text */
    .ar-content {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      text-align: center;
      font-size: 24px;
      z-index: 150;
      display: none;
      max-width: 80%;
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <div class="ui-overlay">
    <div class="instructions" id="instructions">
      Tap the circle to begin
    </div>
    <div class="pulse-circle" id="pulseCircle" onclick="placeARContent()"></div>
    <div class="controls">
      <button class="btn" id="resetBtn" title="Reset">Reset</button>
    </div>
  </div>

  <div class="ar-content" id="arContent">
    <div id="textDisplay">To scan is to Exist.</div>
  </div>

  <div class="error" id="errorMsg">
    <h3>Camera Access Needed</h3>
    <p>Please allow camera access to use AR</p>
    <button onclick="location.reload()">Try Again</button>
  </div>

  <!-- Hidden A-Frame scene -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false;"
    vr-mode-ui="enabled: false"
    style="display: none;">
    
    <a-camera look-controls-enabled="false" arjs-look-controls></a-camera>
    <a-light type="ambient" color="#ffffff" intensity="0.8"></a-light>
    <a-light type="directional" position="0 5 2" intensity="1.0"></a-light>
  </a-scene>

  <script>
    let isARPlaced = false;
    let textAnimationComplete = false;
    let currentTextIndex = 0;

    const texts = [
      "To scan is to Exist.",
      "Object (noun)\nA material thing that can be seen and touched.",
      "Access denied without device",
      "Every QR code is a gate",
      "Wax layers = invisible barriers",
      "Public space, private interface",
      "To be seen, first be scanned",
      "The irony: critiquing gates with gates",
      "Smartness = selective blindness",
      "Your data, their profit",
      "Convenience costs community",
      "Algorithm (noun)\nA rule that decides who belongs",
      "Touch the wax, feel the weight of exclusion",
      "Design for all, not just the app-enabled",
      "End of transmission."
    ];

    // Remove camera permission check since we're not using camera
    document.querySelector('a-scene').addEventListener('loaded', function() {
      // Scene loaded but hidden
    });

    function showError(message) {
      const errorElement = document.getElementById('errorMsg');
      errorElement.querySelector('p').textContent = message;
      errorElement.style.display = 'block';
    }

    // Add click event to the pulse circle
    document.getElementById('pulseCircle').addEventListener('click', placeARContent);

    let touchStartTime = 0;
    document.addEventListener('touchstart', function() {
      touchStartTime = Date.now();
    });
    document.addEventListener('touchend', function(event) {
      const touchDuration = Date.now() - touchStartTime;
      if (touchDuration < 300 && !isARPlaced) {
        placeARContent();
      }
    });

    function placeARContent() {
      if (isARPlaced) return;
      
      const arContent = document.getElementById('arContent');
      arContent.style.display = 'block';
      document.getElementById('pulseCircle').style.display = 'none';
      isARPlaced = true;
      updateInstructions('Data unencrypted, Move your device to explore');
      startTextAnimation();
    }

    function startTextAnimation() {
      if (textAnimationComplete) return;

      const textDisplay = document.getElementById('textDisplay');
      let delay = 0;

      texts.forEach((text, index) => {
        setTimeout(() => {
          textDisplay.innerHTML = text.replace(/\n/g, '<br>');
          if (index === texts.length - 1) {
            textAnimationComplete = true;
          }
        }, delay);
        delay += index === 0 ? 7000 : 5000; // First text shows longer
      });
    }

    document.getElementById('resetBtn').addEventListener('click', function() {
      const arContent = document.getElementById('arContent');
      arContent.style.display = 'none';
      document.getElementById('pulseCircle').style.display = 'block';

      const textDisplay = document.getElementById('textDisplay');
      textDisplay.innerHTML = texts[0];

      isARPlaced = false;
      textAnimationComplete = false;
      currentTextIndex = 0;
      updateInstructions('Tap the circle to begin');
    });

    function updateInstructions(text) {
      document.getElementById('instructions').textContent = text;
    }

    const urlParams = new URLSearchParams(window.location.search);
    const experience = urlParams.get('experience');
    const qrId = urlParams.get('qr');
    if (qrId) { console.log('Launched from QR code:', qrId); }

    function customizeExperience() {
      const textDisplay = document.getElementById('textDisplay');
      switch(experience) {
        case 'demo1':
          textDisplay.innerHTML = 'Demo 1';
          updateInstructions('Demo 1: Tap the circle to begin');
          break;
        case 'demo2':
          textDisplay.innerHTML = 'Demo 2';
          updateInstructions('Demo 2: Tap the circle to begin');
          break;
        case 'museum':
          textDisplay.innerHTML = 'Museum Guide';
          updateInstructions('Museum: Tap the circle to begin');
          break;
      }
    }
    customizeExperience();

    window.addEventListener('error', function(event) {
      console.error('JavaScript error:', event.error);
    });
    window.addEventListener('orientationchange', function() {
      setTimeout(function() {
        window.location.reload();
      }, 500);
    });
  </script>
</body>
</html>